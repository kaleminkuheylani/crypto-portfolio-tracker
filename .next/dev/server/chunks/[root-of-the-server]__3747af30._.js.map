{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/crypto/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n\nconst API_BASE = 'https://api.coinpaprika.com/v1';\nconst IMAGE_BASE = 'https://static.coinpaprika.com/coin';\n\nconst mapPaprikaToCoinData = (coin: any) => {\n  const usdData = coin.quotes?.USD || {};\n  \n  return {\n    id: coin.id,\n    symbol: coin.symbol,\n    name: coin.name,\n    image: `${IMAGE_BASE}/${coin.id}/logo.png`,\n    current_price: usdData.price || 0,\n    market_cap: usdData.market_cap || 0,\n    market_cap_rank: coin.rank,\n    fully_diluted_valuation: usdData.fully_diluted_market_cap || null,\n    total_volume: usdData.volume_24h || 0,\n    high_24h: usdData.ath_price || 0,\n    low_24h: 0,\n    price_change_24h: 0,\n    price_change_percentage_24h: usdData.percent_change_24h || 0,\n    market_cap_change_24h: usdData.market_cap_change_24h || 0,\n    market_cap_change_percentage_24h: usdData.percent_change_24h || 0,\n    circulating_supply: coin.circulating_supply || 0,\n    total_supply: coin.total_supply || 0,\n    max_supply: coin.max_supply || 0,\n    ath: usdData.ath_price || 0,\n    ath_change_percentage: usdData.percent_from_price_ath || 0,\n    ath_date: usdData.ath_date || '',\n    atl: 0,\n    atl_change_percentage: 0,\n    atl_date: '',\n    roi: null,\n    last_updated: new Date().toISOString(),\n    sparkline_in_7d: { price: [] }\n  };\n};\n\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams;\n  const action = searchParams.get('action');\n\n  try {\n    if (action === 'tickers') {\n      const response = await fetch(`${API_BASE}/tickers?quotes=USD`, {\n        headers: {\n          'Accept': 'application/json',\n        },\n        next: { revalidate: 30 }\n      });\n\n      if (!response.ok) {\n        throw new Error('CoinPaprika API Error');\n      }\n\n      const json = await response.json();\n      const coins = json.slice(0, 100).map(mapPaprikaToCoinData);\n      return NextResponse.json(coins);\n    }\n\n    if (action === 'search') {\n      const query = searchParams.get('q');\n      if (!query) {\n        return NextResponse.json([]);\n      }\n\n      const response = await fetch(`${API_BASE}/search?q=${query}&c=currencies&limit=20`);\n      \n      if (!response.ok) {\n        throw new Error('CoinPaprika Search Error');\n      }\n\n      const json = await response.json();\n      \n      if (json.currencies && json.currencies.length > 0) {\n        const coinId = json.currencies[0].id;\n        const tickerResponse = await fetch(`${API_BASE}/tickers/${coinId}`);\n        if (tickerResponse.ok) {\n          const coinDetail = await tickerResponse.json();\n          return NextResponse.json([mapPaprikaToCoinData(coinDetail)]);\n        }\n      }\n      \n      return NextResponse.json([]);\n    }\n\n    if (action === 'feargreed') {\n      const response = await fetch('https://api.alternative.me/fng/', {\n        next: { revalidate: 300 }\n      });\n      \n      if (!response.ok) {\n        throw new Error('F&G API Error');\n      }\n      \n      const json = await response.json();\n      if (json.data && json.data.length > 0) {\n        return NextResponse.json(json.data[0]);\n      }\n      return NextResponse.json(null);\n    }\n\n    if (action === 'sentiment') {\n      const fearGreedResponse = await fetch('https://api.alternative.me/fng/', {\n        next: { revalidate: 300 }\n      });\n      \n      let fearGreedValue = 50;\n      let fearGreedClassification = 'Neutral';\n      \n      if (fearGreedResponse.ok) {\n        const fgJson = await fearGreedResponse.json();\n        if (fgJson.data && fgJson.data.length > 0) {\n          fearGreedValue = parseInt(fgJson.data[0].value);\n          fearGreedClassification = fgJson.data[0].value_classification;\n        }\n      }\n\n      let redditScore = 50;\n      let redditMentions = 0;\n      \n      try {\n        const coingeckoResponse = await fetch(\n          'https://api.coingecko.com/api/v3/search/trending',\n          { next: { revalidate: 600 } }\n        );\n        \n        if (coingeckoResponse.ok) {\n          const trendingData = await coingeckoResponse.json();\n          if (trendingData.coins && trendingData.coins.length > 0) {\n            redditMentions = trendingData.coins.reduce((sum: number, coin: any) => \n              sum + (coin.item?.score || 0), 0\n            );\n            const avgMarketCapRank = trendingData.coins.reduce((sum: number, coin: any) => \n              sum + (coin.item?.market_cap_rank || 100), 0\n            ) / trendingData.coins.length;\n            redditScore = Math.min(80, Math.max(20, 100 - avgMarketCapRank));\n          }\n        }\n      } catch (e) {\n        console.error('CoinGecko trending error:', e);\n      }\n\n      let sentcryptScore = 50;\n      let sentcryptConfidence = 75;\n      \n      try {\n        const globalResponse = await fetch(\n          'https://api.coingecko.com/api/v3/global',\n          { next: { revalidate: 300 } }\n        );\n        \n        if (globalResponse.ok) {\n          const globalData = await globalResponse.json();\n          if (globalData.data) {\n            const marketCapChange = globalData.data.market_cap_change_percentage_24h_usd || 0;\n            sentcryptScore = Math.min(90, Math.max(10, 50 + (marketCapChange * 5)));\n            sentcryptConfidence = Math.min(95, Math.max(60, 80 + Math.abs(marketCapChange)));\n          }\n        }\n      } catch (e) {\n        console.error('CoinGecko global error:', e);\n      }\n\n      const getSentiment = (score: number): 'bullish' | 'bearish' | 'neutral' => {\n        if (score >= 55) return 'bullish';\n        if (score <= 45) return 'bearish';\n        return 'neutral';\n      };\n\n      const overallScore = Math.round((redditScore + sentcryptScore + fearGreedValue) / 3);\n\n      const sentiment = {\n        overall: getSentiment(overallScore),\n        score: overallScore,\n        sources: {\n          reddit: {\n            sentiment: getSentiment(redditScore),\n            score: Math.round(redditScore),\n            mentions: redditMentions\n          },\n          sentcrypt: {\n            sentiment: getSentiment(sentcryptScore),\n            score: Math.round(sentcryptScore),\n            confidence: Math.round(sentcryptConfidence)\n          },\n          fearGreed: {\n            sentiment: getSentiment(fearGreedValue),\n            value: fearGreedValue,\n            classification: fearGreedClassification\n          }\n        },\n        lastUpdated: new Date().toISOString()\n      };\n\n      return NextResponse.json(sentiment);\n    }\n\n    return NextResponse.json({ error: 'Invalid action' }, { status: 400 });\n  } catch (error) {\n    console.error('Crypto API error:', error);\n    return NextResponse.json({ error: 'Failed to fetch data' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}